<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keranjang Belanja - MAYMART</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Orbitron:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="css/theme.css"> <!-- Global theme styles -->
    <link rel="stylesheet" href="css/cart.css"> <!-- Cart page specific styles -->
</head>
<body class="antialiased">

    <div id="page-navbar-container"></div>

    <main class="container mx-auto px-4 py-12">
        <h1 class="cart-page-title">Keranjang Belanja Anda</h1>

        <div id="cart-items-container" class="cart-content-card rounded-lg shadow-xl overflow-hidden">
            <!-- Cart items will be generated by JavaScript -->
        </div>

        <div id="cart-empty-message" class="hidden cart-content-card rounded-lg shadow-xl">
            <i class="fas fa-ghost"></i>
            <p class="empty-text">Keranjang Anda terasa kosong...</p>
            <a href="products.html" class="btn btn-primary start-shopping-btn">Mulai Berburu Produk!</a>
        </div>

        <div id="cart-summary" class="cart-content-card rounded-lg shadow-xl hidden">
            <h2 class="summary-title">Ringkasan Belanja</h2>
            <div class="summary-row">
                <span class="summary-label">Subtotal Produk:</span>
                <span id="cart-subtotal" class="summary-value">Rp 0</span>
            </div>
            <div class="summary-row">
                <span class="summary-label">Biaya Pengiriman:</span>
                <span id="shipping-cost" class="summary-value">Rp 10.000 (Estimasi)</span>
            </div>
            <hr>
            <div class="total-row">
                <span class="total-label">Total Pembayaran:</span>
                <span id="cart-total" class="total-value text-primary">Rp 10.000</span>
            </div>
            <button id="checkout-button" class="btn btn-primary" disabled>
                Lanjut ke Checkout <i class="fas fa-shield-alt"></i>
            </button>
        </div>
    </main>

    <div id="page-footer-container"></div>

    <script src="js/global.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/cart.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            if (typeof isLoggedIn === 'function' && !isLoggedIn()) {
                // User is not logged in. Show a message and redirect.
                const mainContent = document.querySelector('main.container');
                if (mainContent) {
                    mainContent.innerHTML = `
                        <div class="cart-content-card text-center py-10">
                            <i class="fas fa-exclamation-triangle fa-3x text-yellow-400 mb-4"></i>
                            <p class="text-xl text-light-text mb-3">Akses Ditolak</p>
                            <p class="text-dark-subtext mb-6">Anda harus login untuk melihat keranjang belanja.</p>
                            <a href="login.html?redirect=cart.html" class="btn btn-primary">Login Sekarang</a>
                        </div>`;
                }
                // Hide elements that shouldn't be visible
                const cartItemsContainer = document.getElementById('cart-items-container');
                const cartSummaryDiv = document.getElementById('cart-summary');
                if(cartItemsContainer) cartItemsContainer.classList.add('hidden');
                if(cartSummaryDiv) cartSummaryDiv.classList.add('hidden');
                
                // Optionally, redirect after a delay or keep them on the page with the message.
                // For immediate redirect:
                // if (typeof redirectToLogin === 'function') redirectToLogin('cart.html');
                return; 
            }
            
            // If logged in, cart.js's own DOMContentLoaded listener will call displayCartItems, 
            // updateCartCount (though global.js also calls it), and setupCheckoutButton.
            // Explicit calls here ensure they run after the login check.
            if (typeof displayCartItems === 'function') displayCartItems();
            if (typeof setupCheckoutButton === 'function') setupCheckoutButton();
        });
    </script>
</body>
</html>